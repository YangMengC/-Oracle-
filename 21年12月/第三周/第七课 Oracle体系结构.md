# 第七课 Oracle体系结构概述

## 1. Oracle组件架构

![](D:\Pictures\2021-11-29-10-23-38-image.png)

## 2. Oracle服务器

- Oracle服务器是一个数据库管理系统，它提供开放、全面、集成的方法进行信息管理

- 由Oracle实例和Oracle数据库组成

## 3. Oracle实例

![](D:\Pictures\2021-11-29-10-31-25-image.png)

### 实例

概述: 在数据库服务器上启动数据库后, Oracle软件会分配一个称为系统全局区(SGA)的共享内存区, 还会启动若干个Oracle后台进程. 两者的组合就称为一个Oracle实例.

- 访问数据库的一种方法

- 一个实例只能打开一个数据库

- 由内存和后台进程组成

> 在同一台计算机上可以并发执行多个实例,每个实例只访问它自己的物理数据库
> 
> RAC: 多个实例关联访问同一个数据库

### 内存

概述: 此处的内存主要有两个区域, SGA和PGA

- 系统全局区SGA : 在实例启动时分配, 是Oracle实例的基本组件

- 程序全局区PGA : 在服务器进程启动时分配

内存存储的信息有:

- 程序代码

- 连接会话的信息

- 程序执行过程需要的其他信息, 例如查询语句的结果集返回前的状态

- Oracle进程间的通信信息, 例如, 锁信息

- 缓存数据, 例如数据块和重做日志条目信息

参数

MEMORY_TARGET

设定为0, 让SGA和PGA分别管理

### 进程

在操作系统上运行一系列步骤的一种机制

一个具有一定独立功能的程序

关于某个数据集合的一次运行活动

操作系统动态执行的基本单元

在传统的操作系统中, 进程既是基本的分配单元, 也是基本的执行单元

在Linux下, Oracle后台进程是Linux进程; 在NT中, Oracle后台进程是一个进程中执行线程

![](D:\Documents\assets\2021-11-29-11-02-47-image.png)

用户进程 User process = 客户端进程 Client process

- 用户请求连接Oracle服务器时在客户端启动的进程

- 在数据库用户请求连接到Oracle服务器时启动, 请求与Oracle服务器交互的程序, 必须先建立连接, 不与Oracle服务器直接交互

服务器进程 Server process

- 在用户连接上Oracle实例创建会话后, 在服务端启动的进程

- 直接与Oracle服务器交互的程序

- 执行生成的调用并返回相关结果

- 一个服务进程专门用来响应用户进程的请求

- 用户进程断开数据库, 与之相对应的服务器进程就终止了

后台进程 Background process : **后台进程是实例和数据库的纽带**

- 在Oracle例程启动后创建的进程

- 直接与Oracle交互的程序

- 执行维护物理结构与内存结构之间的关系

- 必备的后台进程
  
  - DBWn
    
    - 数据库编写器
    
    - 进程从磁盘读取数据并将其写回到磁盘
    
    - 一个Oracle实例有许多数据库编写器, 如DBW0, DBW1, DBW2等
  
  - PMON
  
  - - Oracle数据库中最活跃的一个进程
    
    - 调节所有其他进程的进程监视器
    
    - 能够清理异常连接的数据库连接, 并自动向侦听器进程注册数据库实例
  
  - CKPT
    
    - 检查点过程
    
    - **<u>在Oracle中，磁盘上的数据称为块，内存中的数据称为缓冲区。&nbsp;当该块写入缓冲区并更改时，缓冲区变脏，需要将其写入磁盘。CKPT进程使用检查点信息更新控制和数据文件头，并向脏盘写入脏缓冲区的信号</u>**。
  
  - LGWR
    
    - 可恢复架构的关键
    
    - 在数据库中发生的每个变化都被写入到一个名为redo的日志文件中用于恢复; 而这些变化就是有LGWR进程编写和记录的
    
    - LGWR进程首先将更改写入内存, 然后将磁盘写入重做日志, 然后将其用于恢复
  
  - SMON
    
    - 执行系统级清理操作的系统监视进程
    
    - 在发生故障的情况下自动恢复实例, 例如断电和清理临时文件

- 可选的后台进程
  
  - ARCn
    
    - 归档进程, 将重做日志的内容复制到归档重做日志文件
    
    - 可以有多个进程
    
    - 允许写入多个目标
  
  - LMDn、RECO、CJQ0、LMON、Snnn、Dnnn、Pnnn、LCKn、QMNn

附加

> 专有服务器模式下, 一个用户进程与服务器进程一一对应
> 
> 共享服务器模式下, 多个用户进程可能对应一个服务器进程

## 4. Oracle数据库

Oracle数据库, 是操作系统上数据文件的集合, 数据文件是真正存放用户数据的地方

**3个必须且重要的文件 + 3个非必须但重要的文件**

- data files + control files + redo log files
  
  - 数据文件 : 包含数据库中实际数据的数据文件
  
  - 控制文件 : 包含维护和核实数据库完整性所必须的信息
  
  - 重做日志文件 : 记录数据库的更改, 以便在发生故障时能够恢复数据

- parameter files + password files + archived redo log files
  
  - 参数文件 : 定义了Oracle实例的特征. 例如它包含的参数大小决定了SGA中某些内存结构的大小
  
  - 密码文件 : 对有权启动和关闭Oracle实例的用户进行身份验证
  
  - 归档重做日志文件 : 重做日志文件的脱机副本

## 5. 连接与会话

![](D:\Documents\assets\2021-11-29-14-22-18-image.png)

### 连接 Connection

客户端进程与Oracle实例之间的一个物理通信通道. 物理通信通道可以通过进程间通信机制或网络协议确认.

### 会话 Session

会话是一个逻辑概念, 表示用户登录数据库的一种状态. 当用户通过密码登陆数据库时, 就建立了一个用户对应的会话. 用户断开数据库连接, 会话即结束.

对于一个用户来说, 可能同时存在多个会话, 因为oracle数据库允许用户同时多次并发连接, 例如sqlplus工具, 或应用程序中配置连接数据库

### 进程与会话的查询

- 查看会话的信息, 包括用户连接的程序、所在的客户端
  
  ```sql
  select sid, serial#, paddr, username, program, machine
      from v$session
          where username='SYSTEM';
  ```

- 查看会话对应的Oracle服务进程
  
  ```sql
  select username, program, terminal, spid
      from v$process
          where addr in ('000000008FF3E1C0','000000008FF40240');
  ```

- 杀会话
  
  ```sql
  alter system kill session 'xxx,xxx'
  ```
